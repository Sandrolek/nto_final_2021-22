# nto_final_2021-22

Репозиторий команды Мантия-Подоконник, на Финале НТО 2021-2022 по профилю Летающая Робототехника

Финал проходил 28.04.22 - 02.04.22

Состав команды и роли:
- Поляков Александр     капитан         https://t.me/Sandrolek
- Демьяненко Егор       инженер-техник  
- Синюков Лев           программист
- Елисеев Емельян       программист

Ссылка на гугл диск с моделями https://drive.google.com/drive/folders/1TcIkymVdHU_IC5E0i0Q_pzfif0QSvtq4

Задание:
1-2 день:
https://docs.google.com/document/d/1E8hxeu60CNDtsYT0D9NYcGdX495NEFJQ/edit#heading=h.8agvjoyxdqaz

3 день:
https://docs.google.com/document/d/1lMWmyJKzi-Vau_RM97uhbCen9nd58jnL/edit#

4 день:
https://docs.google.com/document/d/1cJ_QN4CqVu8bvvzMzmELmg_1OM894CvA/edit#

Решенные задачи:
  - Распознование QR кода
  - Движение по линии
  - Выделение объектов определенного цвета или формы

Методы решения задач:
  - Для распознавания QR-кодов мы использовали библиотеку pyZBar
  - Для движения по линии мы использовали пропорциональный регулятор
  - Работа с изображением была с помощью библиотеки OpenCV Python

Общая структура программы (4 день, как самое полное задание)
  - Взлетаем
    - Читаем QR код => Находим координаты начала линии и координаты озера
    - Запоминаем свои координаты, чтобы после на них вернуться
  - Летим к озеру, снижаемся над ним
  - Летим к началу линии
  - Производим поворот на линию, с помощью выделения ее контуров и определения их наклона
  
  - Запускаем поиск дефектов и поиск разливов
  
  - Пролетаем по линии, если встречаем развилку то:
    - подлетаем именно к ней
    - запоминаем свою координату как координату развилки
    - поворачиваемся в одну из сторону
    - продолжаем движение по линии, когда потеряем линию - возврат в запомненную точку и поворот и пролет по оставшейся ветке линии
    - когда теряем линию уже после пролета по второму ответвлению, то летим на стартовую позицию

Подзадачи:

1) Структура полета по линии
  Накладываем маску для выделения линии по цвету
  Ищем контуры
  Ищем самый большой по площади контур и выделяем его прямоугольником
  Ориентируясь на угол поворота прмоугольнка задаем поворот дрона
  Немного продвигаемся вперед по линии
  И П-регулятор по ошибке отклонения линии от центра

2) Поиск дефектов
  Накладываем на изображение маску дефекта (ее можно найти, при помощи таких программ, как hsv_finder.py, приложены к проекту)
  Выделяем контур по площади, не самый большой и не самый маленький
  Когда расстояние от центра картинки до дефекта меньше определенного, то считаем что текущую координату коптера можно считать как координату дефекта
  Каждый найденный дефект проверяем на то, был ли он у же у нас найден - в общий массив добавляем

3) Поиск разливов
  Может быть два варианта - искать разливы, когда нашли дефект. Можно же отдельно искать разливы и дефекты, а потом их связывать по координатам.
  В любом случае мы применяем на изображение маску разлива
  После ищем все контуры, бОльшие определенной константы, чтобы отсечь шумы
  Ищем центр и то же самое, что с дефектами.
  

![photo_2022-04-01_14-38-51](https://user-images.githubusercontent.com/37073843/161256375-e6ac746a-3c30-45bb-925d-ea8f49b8f807.jpg)
![photo_2022-04-01_14-38-48](https://user-images.githubusercontent.com/37073843/161256398-ab9208a4-1465-4161-ae7d-61e14827f109.jpg)
![photo_2022-04-01_14-39-13](https://user-images.githubusercontent.com/37073843/161256403-6f2425d7-8323-417d-9eb0-a01f6d34df97.jpg)
